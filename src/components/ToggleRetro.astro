---
/** ToggleRetro: adds/removes class on html for retro overlay and dark variant */
---

<div
	class="retro-toggles"
	style="display:flex; gap:.5rem; align-items:center; font-size:12px;"
>
	<label><input type="checkbox" data-scan /> Scanlines</label>
	<label><input type="checkbox" data-dark /> Dark</label>
	<label><input type="checkbox" data-sfx /> SFX</label>
</div>
<script is:inline>
	(function () {
		const root = document.currentScript.parentElement;
		const scan = root.querySelector("[data-scan]");
		const dark = root.querySelector("[data-dark]");
		const sfx = root.querySelector("[data-sfx]");
		scan.checked = document.documentElement.classList.contains("retro-extra");
		dark.checked = document.documentElement.classList.contains("dark");
		scan.addEventListener("change", () => {
			document.documentElement.classList.toggle("retro-extra", scan.checked);
			localStorage.setItem("retroExtra", scan.checked ? "1" : "0");
		});
		dark.addEventListener("change", () => {
			document.documentElement.classList.toggle("dark", dark.checked);
			localStorage.setItem("retroDark", dark.checked ? "1" : "0");
		});
		// restore preferences
		if (localStorage.getItem("retroExtra") === "1") {
			document.documentElement.classList.add("retro-extra");
			scan.checked = true;
		}
		if (localStorage.getItem("retroDark") === "1") {
			document.documentElement.classList.add("dark");
			dark.checked = true;
		}

		// SFX toggle: lazy-load manager, init state and persist
		(function initSfxToggle() {
			function fallbackDefault() {
				const saved = localStorage.getItem("retroSounds");
				if (saved === "1") return true;
				if (saved === "0") return false;
				return !matchMedia("(prefers-reduced-motion: reduce)").matches;
			}
			sfx.checked = fallbackDefault();
			import('/src/lib/sfx.js').then((mod) => {
				const api = mod && mod.getSfx ? mod.getSfx() : null;
				if (api) {
					// sync UI from manager
					sfx.checked = !!api.enabled;
					sfx.addEventListener('change', () => {
						api.setEnabled(sfx.checked);
					});
				}
			}).catch(() => {});
		})();
	})();
</script>
<style is:inline>
	.retro-toggles input {
		vertical-align: middle;
	}
</style>
